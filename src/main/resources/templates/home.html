<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
    <title>Shoes Online Store</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="keywords" content="Online Store">
    <link rel="stylesheet" th:href="@{/css/vendor.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/style.css}">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:ital,wght@0,900;1,900&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"
          rel="stylesheet">
</head>

<body>

<div class="preloader"
     style="position: fixed;top:0;left:0;width: 100%;height: 100%;background-color: #fff;display: flex;align-items: center;justify-content: center;z-index: 9999;">
    <svg version="1.1" id="L4" width="100" height="100" xmlns="http://www.w3.org/2000/svg"
         x="0px" y="0px"
         viewBox="0 0 50 100" enable-background="new 0 0 0 0" xml:space="preserve">
    <circle fill="#111" stroke="none" cx="6" cy="50" r="6">
      <animate
              attributeName="opacity"
              dur="1s"
              values="0;1;0"
              repeatCount="indefinite"
              begin="0.1"/>
    </circle>
        <circle fill="#111" stroke="none" cx="26" cy="50" r="6">
      <animate
              attributeName="opacity"
              dur="1s"
              values="0;1;0"
              repeatCount="indefinite"
              begin="0.2"/>
    </circle>
        <circle fill="#111" stroke="none" cx="46" cy="50" r="6">
      <animate
              attributeName="opacity"
              dur="1s"
              values="0;1;0"
              repeatCount="indefinite"
              begin="0.3"/>
    </circle>
    </svg>
</div>

<!-- quick view -->
<div class="modal fade" id="modaltoggle" aria-hidden="true" tabindex="-1">
    <div class="modal-dialog modal-fullscreen-md-down modal-md modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <div class="col-lg-12 col-md-12 me-3">
                    <div class="image-holder">
                        <img th:src="@{/images/summary-item1.jpg}" alt="Shoes">
                    </div>
                </div>
                <div class="col-lg-12 col-md-12">
                    <div class="summary">
                        <div class="summary-content fs-6">
                            <div class="product-header d-flex justify-content-between mt-4">
                                <h3 class="display-7">Running Shoes For Men</h3>
                                <div class="modal-close-btn">
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                    </button>
                                </div>
                            </div>
                            <span class="product-price fs-3">$99</span>
                            <div class="product-details">
                                <p class="fs-7">Buy good shoes and a good mattress, because when you're not in one
                                    you're in the
                                    other. With four pairs of shoes, I can travel the world.</p>
                            </div>
                            <ul class="select">
                                <li>
                                    <strong>Colour Shown:</strong> Red, White, Black
                                </li>
                                <li>
                                    <strong>Style:</strong> SM3018-100
                                </li>
                            </ul>
                            <div class="variations-form shopify-cart">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="quantity d-flex pb-4">
                                            <div
                                                    class="qty-number align-top qty-number-plus d-flex justify-content-center align-items-center text-center">
                          <span class="increase-qty plus">
                            <svg class="plus">
                                <use th:href="@{/images/icons.svg#plus}"></use>
                            </svg>
                          </span>
                                            </div>
                                            <input type="number" id="quantity_001" class="input-text text-center"
                                                   step="1" min="1" name="quantity" value="1" title="Qty">
                                            <div
                                                    class="qty-number qty-number-minus d-flex justify-content-center align-items-center text-center">
                          <span class="increase-qty minus">
                            <svg class="minus">
                                <use th:href="@{/images/icons.svg#minus}"></use>
                            </svg>
                          </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <a rel="nofollow" data-no-instant="" href="#" class="out-stock button">Out of
                                            stock</a>
                                        <button type="submit" class="btn btn-medium btn-black hvr-sweep-to-right">Add to
                                            cart
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- variations-form -->
                            <div class="categories d-flex flex-wrap pt-3">
                                <strong class="pe-2">Categories:</strong>
                                <a href="#" title="categories">Clothing,</a>
                                <a href="#" title="categories">Men's Clothes,</a>
                                <a href="#" title="categories">Tops & T-Shirts</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / quick view -->

<div class="modal fade" id="cart-model" tabindex="-1" aria-modal="true" role="dialog">
    <div class="modal-dialog modal-fullscreen-md-down modal-md modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title fs-5">Cart</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div id="cart-model-body" class="modal-body">

            </div>
        </div>
    </div>
</div>

<!-- cart view -->

<header id="header" class="site-header text-black">
    <nav id="header-nav" class="navbar navbar-expand-lg">
        <div class="container-lg">
            <div class="d-flex justify-content-end align-items-center">
                <div class="d-flex justify-content-end align-items-center">
                    <div>
                    <span sec:authorize="isAuthenticated()">
                        <a href="/logout" class="btn btn-primary">Logout</a>
                    </span>
                        <span sec:authorize="!isAuthenticated()">
                        <a href="/login" class="btn btn-primary">Login</a>
                    </span>
                    </div>
                    <a href="#" class="border-0" id="cartButton">
                        <svg class="shopping-cart" width="24" height="24">
                            <use th:href="@{/images/icons.svg#shopping-cart}"></use>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </nav>
</header>

<section id="featured-products" class="product-store">
    <div class="container-md">
        <div class="display-header d-flex align-items-center justify-content-between">
            <h2 class="section-title text-uppercase">Featured Products</h2>
        </div>
        <div class="product-content padding-small">
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5">
                <div th:each="product : ${productPage.content}">
                    <div class="col mb-4">
                        <div class="product-card position-relative">
                            <div class="card-img">
                                <img th:src="${product.imageUrl}" alt="product-item" class="product-image img-fluid">
                                <div class="cart-concern position-absolute d-flex justify-content-center">
                                    <div class="cart-button d-flex gap-2 justify-content-center align-items-center">
                                        <button type="button" class="btn btn-light add-to-cart-btn"
                                                th:onclick="'addToCartAndShow(\'' +${product.id}+ '\');'">
                                            <svg class="shopping-carriage">
                                                <use th:href="@{/images/icons.svg#shopping-carriage}"></use>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-detail d-flex justify-content-between align-items-center mt-3">
                                <h3 class="card-title fs-6 fw-normal m-0">
                                    <a href="index.html" th:text="${product.name}"></a>
                                </h3>
                                <span class="card-price fw-bold" th:text="${product.price}"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-container text-center mt-4">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${productPage.hasPrevious() ? '' : ' disabled'}">
                        <a class="page-link" href="#"
                           th:href="@{'?page=' + ${productPage.number - 1} + '&size=' + ${productPage.size}}">Previous</a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, productPage.totalPages - 1)}"
                        th:classappend="${i == productPage.number ? ' active' : ''}">
                        <a class="page-link" th:href="@{'?page=' + ${i} + '&size=' + ${productPage.size}}"
                           th:text="${i + 1}"></a>
                    </li>
                    <li class="page-item" th:classappend="${productPage.hasNext() ? '' : ' disabled'}">
                        <a class="page-link" href="#"
                           th:href="@{'?page=' + ${productPage.number + 1} + '&size=' + ${productPage.size}}">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</section>


<script th:src="@{/js/jquery-1.11.0.min.js}"></script>
<script th:src="@{/js/plugins.js}"></script>
<script th:src="@{/js/script.js}"></script>
<!--<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>-->

<script>
    // Add this script to your page
    document.addEventListener('DOMContentLoaded', function () {
        const cartButton = document.getElementById('cartButton');

        cartButton.addEventListener('click', function (e) {
            e.preventDefault();
            loadAndShowCart();
        });
    });

    function loadAndShowCart() {

        // Show loading indicator in the modal
        const cartModal = document.getElementById('cart-model');
        const modalBody = document.getElementById('cart-model-body')
        modalBody.innerHTML = '<div class="text-center p-5"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></div>';

        // Show the modal while loading data
        const bsModal = new bootstrap.Modal(cartModal);
        bsModal.show();

        // Fetch cart data from the API
        fetch('/cart')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(html => {
                // Replace modal content with the fetched HTML
                modalBody.innerHTML = html;
            })
            .catch(error => {
                console.error('Error fetching cart data:', error);
                modalBody.innerHTML = '<div class="text-center p-3">Failed to load cart. Please try again.</div>';
            });
    }

    function addToCartAndShow(productId) {
        fetch('/cart/add', {
            method: 'POST',
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams({productId: productId}),
            credentials: 'same-origin' // Important for sending cookies with the request
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to add product to cart');
                }
                loadAndShowCart();
            })
    }

    function removeFromCartAndShow(productId) {
        fetch('/cart/remove', {
            method: 'POST',
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams({productId: productId}),
            credentials: 'same-origin' // Important for sending cookies with the request
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to remove product to cart');
                }
                loadAndShowCart();
            })
    }


    function plusCartAndShow(productId) {
        fetch('/cart/plus', {
            method: 'POST',
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams({productId: productId}),
            credentials: 'same-origin' // Important for sending cookies with the request
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to plus product to cart');
                }
                loadAndShowCart();
            })
    }


    function minusCartAndShow(productId) {
        fetch('/cart/minus', {
            method: 'POST',
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams({productId: productId}),
            credentials: 'same-origin' // Important for sending cookies with the request
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to minus product to cart');
                }
                loadAndShowCart();
            })
    }


    function checkOutCart() {
        fetch('/cart/check-out', {
            method: 'POST',
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams({}),
            credentials: 'same-origin'
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to add check-out to cart');
                }
                loadAndShowCart();
            })
    }
</script>

</body>

</html>